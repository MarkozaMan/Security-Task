const KeycloakService=function(e){let n=null;let t=false;let i=false;let c=null;return{init:function(){const r=e.Deferred();if(t){r.resolve(i);return r.promise()}n=new Keycloak({url:o.KeycloakUrl,realm:o.KeycloakRealm,clientId:o.KeycloakClientId});n.init({onLoad:"check-sso",silentCheckSsoRedirectUri:window.location.origin+o.SilentCheckSsoRedirectUri,checkLoginIframe:true,checkLoginIframeInterval:5,enableLogging:false}).then(function(e){console.log("Keycloak initialized. Authenticated:",e);i=e;if(e){c=KeycloakService.getUserInfo()}t=true;r.resolve(e)}).catch(function(e){console.error("Keycloak initialization failed:",e);r.reject(e)});return r.promise()},login:function(e){if(!n){console.error("Keycloak not initialized");return}if(!e){e=window.location.href}n.login({redirectUri:e})},logout:function(e){if(!n){console.error("Keycloak not initialized");return}if(!e){e=window.location.href}const r=n.idToken;if(r){n.logout({redirectUri:e,idTokenHint:r})}else{n.logout({redirectUri:e})}},getToken:function(){if(!n){return null}return n.token},refreshToken:function(){const r=e.Deferred();if(!n){r.reject(new Error("Keycloak not initialized"));return r.promise()}n.updateToken(30).then(function(e){console.log("Token refreshed:",e);r.resolve(n.token)}).catch(function(e){console.error("Token refresh failed:",e);r.reject(e)});return r.promise()},isAuthenticated:function(){if(!n){return false}return n.authenticated},getUserInfo:function(){if(!n||!n.tokenParsed)return null;return{username:n.tokenParsed.preferred_username,email:n.tokenParsed.email,firstName:n.tokenParsed.given_name,lastName:n.tokenParsed.family_name,fullName:n.tokenParsed.name,roles:n.realmAccess?n.realmAccess.roles:[],groups:n.tokenParsed.groups||[]}},hasRole:function(e){if(!n||!n.realmAccess)return false;return n.realmAccess.roles.indexOf(e)!==-1},hasResourceRole:function(e,r){if(!n||!n.resourceAccess||!n.resourceAccess[r])return false;return n.resourceAccess[r].roles.indexOf(e)!==-1},getTokenExpiresIn:function(){if(!n||!n.tokenParsed)return 0;return n.tokenParsed.exp-Math.floor(Date.now()/1e3)},setAjaxHeaders:function(){e.ajaxSetup({beforeSend:function(e,r){if(KeycloakService.isAuthenticated()){e.setRequestHeader("Authorization","Bearer "+KeycloakService.getToken())}}})}}}(jQuery);